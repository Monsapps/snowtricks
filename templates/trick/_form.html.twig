{{ form_start(form) }}
{{ form_row(form._token) }}
    {% if app.request.attributes.get('_route') == "add_trick" %}
        <div class="row mb-4 px-5">
            <div class="col-12 col-md-10 mx-auto">
                {{ form_row(form.nameTrick) }}
            </div>
        </div>
    {% endif %}
    <div class="row mb-4 px-5">
        <div class="col-12 col-md-10 mx-auto" id="trick-description">
            {{ form_row(form.descriptionTrick) }}
        </div>
    </div>
    <div class="row mb-4 px-5">
        <div class="col-12 col-md-10 mx-auto">

            {{ form_row(form.trickType) }}

            {% if app.request.attributes.get('_route') == "add_trick" %}
                {{ form_row(form.addNewType) }}
            {% endif %}

        </div>
    </div>
    <div class="row mb-4 px-5">
        <div class="col-12 col-md-10 mx-auto">
            {{ form_row(form.images) }} 
        </div>
    </div>
    <div class="row mb-4 px-5">
        <div class="col-12 col-md-10 mx-auto">
            {{ form_label(form.medias) }} <button type="button" class="add_item_link" data-collection-holder-class="medias">Add media</button>
            <ul class="medias" data-index="{{ form.medias|length > 0 ? form.medias|last.medias.name + 1 : 0 }}" data-prototype="{{ form_widget(form.medias.vars.prototype)|e('html_attr') }}"></ul>
        </div>
    </div>
    <div class="row mb-4 px-5">
        <div class="col-12 col-md-10 text-end">
            {% if app.request.attributes.get('_route') == "update_trick" %}
                <button type="button" class="btn btn-danger">Delete</button>
            {% endif %}
                <button type="submit" class="btn btn-primary">{{ button_label|default('Save') }}</button>
        </div>
    </div>
</div>
{{ form_end(form) }}

<script>
    // Prototype
    const addTagFormDeleteLink = (tagFormLi) => {
        const removeFormButton = document.createElement('button')
        removeFormButton.classList
        removeFormButton.innerText = 'Delete this media'

        tagFormLi.append(removeFormButton);

        removeFormButton.addEventListener('click', (e) => {
            e.preventDefault()
            // remove the li for the tag form
            tagFormLi.remove();
        });
    }

    const addFormToCollection = (e) => {
        const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

        const item = document.createElement('li');

        item.innerHTML = collectionHolder
            .dataset
            .prototype
            .replace(
            /__name__/g,
            collectionHolder.dataset.index
            );

        collectionHolder.appendChild(item);
        addTagFormDeleteLink(item);

        collectionHolder.dataset.index++;
    };

    document
        .querySelectorAll('.add_item_link')
        .forEach(btn => btn.addEventListener("click", addFormToCollection));

    // Listen checkbox status
    let checkbox = document.querySelector("#trick_addNewType");
    checkbox.checked = false;
    checkbox.addEventListener("change", function() {
        let form = this.closest("form");

        var data = "";
        var mainElement = "#trick_trickType";
        var secondElement = "#trick_newTrickType";
        if(this.checked) {
            // Restore default value to selector
            form.querySelector("#trick_trickType").setAttribute("value", "");

            // Add value only if cheched
            data = this.name + "=" + this.value;
            mainElement = "#trick_newTrickType";
            secondElement = "#trick_trickType";
        }
        
        fetch(form.action, {
            method: form.getAttribute("method"),
            body: data,
            mode: "cors",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded; charset:UTF-8;"
            }
        })
        .then(response => response.text())
        .then(html => {
            let content = document.createElement("html");
            content.innerHTML = html;
            let trickTypeElement = content.querySelector(mainElement);
            document.querySelector(secondElement).replaceWith(trickTypeElement);
            console.log(html);
        })
        .catch( e => console.log(e))
    });
</script>
